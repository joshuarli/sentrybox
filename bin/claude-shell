#!/bin/bash

# This runs as the Lima user (who has sudo), opens the
# socket permissions, then switches to claude with
# SSH_AUTH_SOCK preserved.

if [ -n "$SSH_AUTH_SOCK" ] && [ -S "$SSH_AUTH_SOCK" ]; then
  chmod o+rx "$(dirname "$SSH_AUTH_SOCK")"
  chmod o+rw "$SSH_AUTH_SOCK"
  SUDO="sudo --preserve-env=SSH_AUTH_SOCK -iu claude"
else
  SUDO="sudo -iu claude"
fi

if [ $# -eq 0 ]; then
  exec $SUDO bash -c 'cd ~/code/sentry && exec bash'
else
  exec $SUDO "$@"
fi
